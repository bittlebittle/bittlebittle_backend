<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bottleMapper">

   <resultMap id="bottleResultSet"
      type="bottle">
      <result property="bottleNo" column="BOTTLE_NO_PK"/>
      <result property="bottleName" column="BOTTLE_NAME"/>
      <result property="bottleContent" column="BOTTLE_CONTENT" />
      <result property="bottleBrand" column="BOTTLE_BRAND" />
      <result property="viewCnt" column="VIEW_CNT" />
      <result property="createDate" column="CREATE_DATE" jdbcType="TIME" javaType="String" />
      <result property="imgUrl" column="IMG_URL" />
      <result property="imgCusUrl" column="IMG_CUS_URL" />
      <result property="status" column="STATUS" />
   </resultMap>

   <select id="selectOne" parameterType="Integer" resultMap="bottleResultSet">
       <![CDATA[   
         SELECT *
         FROM bottle_tb
         WHERE bottle_no_pk=#{bottleNo}
      ]]>
   </select>
   
   <update id="updateViewCnt" parameterType="Integer">
       <![CDATA[   
         UPDATE bottle_tb
         SET VIEW_CNT=VIEW_CNT+1
         WHERE bottle_no_pk=#{bottleNo}
      ]]>
   </update>
   

   <select id="selectRelated" parameterType="Integer" resultMap="bottleResultSet">
       <![CDATA[   
        SELECT BOTTLE_NAME, IMG_URL
		FROM bottle_tag_tb bt
		INNER JOIN bottle_tb b
		ON b.bottle_no_pk=bt.bottle_no_fk
		WHERE tag_no_fk in (
		SELECT tag_no_fk
		FROM bottle_tb b
		INNER JOIN bottle_tag_tb bt
		ON b.bottle_no_pk=bt.bottle_no_fk
		WHERE b.bottle_no_pk=#{bottleNo})
		AND bt.bottle_no_fk != #{bottleNo}
		GROUP BY bottle_no_fk
		ORDER BY count(tag_no_fk) DESC
		LIMIT 5
		
      ]]>
   </select>

   <update id="insertOne" parameterType="bottle">
       <![CDATA[   
         INSERT INTO bottle_tb(BOTTLE_NAME, BOTTLE_CONTENT, BOTTLE_BRAND, BOTTLE_ABV, IMG_URL)
         VALUES(#{bottleName}, #{bottleContent}, #{bottleBrand}, #{bottleAbv}, #{imgUrl})
      ]]>
   </update>
   
   <!--
    <update id="updateOne" parameterType="bottle">
       <![CDATA[   
         UPDATE bottle_tb
         SET BOTTLE_NAME=#{bottleName}, BOTTLE_CONTENT=#{bottleContent}, BOTTLE_BRAND=#{bottleBrand}, IMG_URL=#{imgUrl}
         WHERE bottleNo=#{bottleNo}
      ]]>
   </update>
	-->
  
   <select id="selectAll" resultMap="bottleResultSet">
        SELECT bottleName
        FROM bottle_tb
    </select>
</mapper>
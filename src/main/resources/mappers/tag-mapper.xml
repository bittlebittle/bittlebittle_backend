<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tagMapper">

	<resultMap id="tagResultSet" type="tag">
		<result property="tagNo" column="TAG_NO_PK" />
		<result property="keyTypeNo" column="TAG_TYPE_NO_FK" />
		<result property="tagName" column="TAG_NAME" />
	</resultMap>

	<resultMap id="tagTypeResultSet" type="tagType">
		<result property="tagTypeNo" column="TAG_TYPE_NO_PK" />
		<result property="tagTypeName" column="TAG_TYPE_NAME" />
	</resultMap>

	<select id="selectAllTagType" resultMap="tagTypeResultSet">
       <![CDATA[   
         SELECT *
         FROM tagtype_tb
      ]]>
	</select>

	<select id="selectAllTag" resultMap="tagResultSet">
       <![CDATA[   
         SELECT *
         FROM tag_tb
      ]]>
	</select>

	<select id="selectTag" parameterType="Integer"
		resultMap="tagResultSet">
       <![CDATA[   
         SELECT TAG_NO_PK,TAG_TYPE_NO_FK,TAG_NAME
         FROM bottle_tag_tb bt
         INNER JOIN tag_tb t
         ON bt.bottle_tag_fk=t.tag_no_pk
         WHERE bottle_no_fk = #{bottleNo}
      ]]>
	</select>

	<update id="deleteBottleTag" parameterType="Integer">
       <![CDATA[   
         DELETE *
         FROM bottle_tag_tb
         WHERE bottleNo=#{bottleNo}
      ]]>
	</update>


	<update id="insertBottleTag" parameterType="java.util.List">
       <![CDATA[   
         INSERT INTO bottle_tag.tb(tag_no_fk, bottle_no_fk)
         VALUES
         <foreach collection="tagList" item="item" separator=",">
         	(#{item.tagNo}, #{item.bottleNo})
         </foreach>
      ]]>
	</update>

	<!-- 회원가입 시 사용자가 선택한 태그 정보를 user_tag_tb에 저장하는 쿼리 -->
	<insert id="addUserTags" parameterType="map">
		INSERT INTO user_tag_tb (user_no_fk, tag_no_fk)
		VALUES
		<foreach collection="tagNoList" item="tagNo" separator=",">
			(#{userNo}, #{tagNo})
		</foreach>
	</insert>

	<!-- 사용자가 선택한 태그 정보 중 선택된 것만 삭제하는 쿼리 -->
	<delete id="deleteUserTags" parameterType="map">
		DELETE FROM user_tag_tb
		WHERE user_no_fk = #{userNo}
		AND tag_no_fk IN
		<foreach item="tagNo" collection="tagNoList" open="("
			separator="," close=")">
			#{tagNo}
		</foreach>
	</delete>


	<!-- 사용자가 선택한 태그 정보를 삭제하는 쿼리
	<delete id="deleteUserTags" parameterType="int">
		DELETE FROM
		user_tag_tb WHERE user_no_fk = #{userNo}
	</delete>
	
	 -->

	<!-- tag_no_pk 값을 이용하여 태그 이름을 가져오는 쿼리 <select id="getTagName" parameterType="int" 
		resultType="string"> SELECT tag_name FROM tag_tb WHERE tag_no_pk = #{tagNo} 
		</select> -->

</mapper>